<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Home Assistant Import</title>
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <h1>Home Assistant Import</h1>
      <h2>Install & gather information</h2>
        <ol>
          <li>Create a full backup of your instance.</li>
          <li>Review your sql skills with <a href="https://www.w3schools.com/sql" target="blank">w3schools.com/sql</a> so you know that you are doing.</li>
          <li>Install <a href="https://community.home-assistant.io/t/home-assistant-community-add-on-sqlite-web/68912" target="blank">Home Assistant Community Add-on: SQLite Web</a>.</li>
          <li>Run this query to find out the Id of the sensor.<br />
            <textarea rows="5">
SELECT sm.Id, sm.statistic_id, sm.unit_of_measurement, min(s.start) start, min(s.state) state, min(s.sum) sum
FROM "statistics" s
join statistics_meta sm on sm.id = s.metadata_id and has_sum = true
group by sm.Id, sm.statistic_id, sm.unit_of_measurement
            </textarea>
          </li>
          <li>
            Update the number with the Id of the sensor you want to update.<br />
            <input id="metadataId" type="number" value="1" />
          </li>
          <li>
            What would you like to do with existing data?<br/>
            <select id="existingDataMode">
              <option value="update">Update sum with total sum of history (sum is updated, can only be done once!)</option>
              <option value="delete">Delete existing data</option>
              <option value="none">Do nothing with existing data (sum may become incorrect)</option>
            </select>
          </li>
        </ol>
      
      <h2>Create import scripts</h2>
      <ol>
        <li>
          Select a file to analyze. <br />
          <button id="openFile">Open file</button>
        </li>
        <li>File in use: <span class="important" id="filePath"></span></li>
        <li>Analysis: <span class="important" id="message"></span> <span class="error" id="error"></span></li>
        <li>
          Select an entity to import. <br/>
          <select id="entityId">
          </select>
        </li>
        <li>
          Select a multiplier for the value. <br />
          <select id="transformValueMode">
            <option value="devide1000">value / 1000 (Wh -> kWh, dm3 -> m3)</option>
            <option value="multiply1000">value * 1000 (kWh -> Wh, m3 -> dm3)</option>
            <option value="none">Do nothing with existing value</option>
          </select>
        </li>
      </ol>

      <h2>Script to import</h2>
      <ol>
        <li>
          Run all the queries one by one. <br />
          <textarea rows="20" id="result"></textarea>
        </li>
      </ol>
      

      <h2>Check out the results</h2>
      Go to the Home Assisant energy dashboard and go back in time. You should now see your history.

      <!-- always load the scrips as last -->
      <script src="./index.js"></script>
  </body>
</html>
